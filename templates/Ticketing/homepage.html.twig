{% extends 'base.html.twig' %}

{% block body %}

    <div id="welcomeMessage">
        <h1>Billeterie du musée du Louvre</h1>
        <p>Achetez dès maintenant vos billets pour éviter la file d'attente !</p>
    </div>

    <a class="btn btn-primary" href="#ticketing">Acheter vos billets</a>

    <img src="{{ asset('Images/Louvre.jpg') }}">


    <div id="pricing">
        <h2 id="princingTitle">Les tarifs</h2>
        <div class="jumbotron" id="listPrice">
            <ul>
                <li>Tarif normal (à partir de 12 ans) : 16€</li>
                <li>Tarif enfant (à partir de 4 ans et jusqu'à 12 ans) : 8€</li>
                <li>Tarif senior (à partir de 60 ans) : 12€</li>
                <li>Tarif réduit (Étudiant, employé du musée, d'un ministère de la Culture, militaire ...) : 10€</li>
            </ul>
        </div>
    </div>
    <div id="ticketing">
        <h2 id="ticketingTitle">Billetterie</h2>
        <div id="calendar">
            <!--<input type="text" placeholder="Date de la visite" id"datepicker" readonly="readonly">-->
        </div>
        <!--<div id="ticketType">
            <button type="button" class="btn btn-dark">1/2 journée</button>
            <button type="button" class="btn btn-dark">1 journée</button>
        </div>-->
        <div>

            <p id="messageSold" style="display: none">Le nombre de places pour cette journée ont toutes été vendues</p>
            {{ form_start(form) }}

            {{ form_row(form.bookingday) }}
            {{ form_row(form.type) }}
            <div id="halfDay" style="display: none"><p>Il est plus de 14h, donc vous pouvez seulement acheter des billets 1/2 today</p></div>
            {{ form_row(form.quantity) }}

            <button type="submit" class="btn btn-primary" id="submitBooking">Envoyer</button>

            {{ form_end(form) }}


    </div>

    <script>

        var holidays = ["12/25/2018", "05/01/2019", "11/01/2019", "12/25/2019", "05/01/2020", "11/01/2020", "12/25/2020"];


        $( function() {
            $( "#booking_bookingday" ).datepicker({
                minDate : '0',
                maxDate : '+1Y',
                dateFormat : "dd/mm/yy",
                dayNames: [ "Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi" ],
                dayNamesMin: [ "Di", "Lu", "Ma", "Me", "Je", "Ve", "Sa" ],
                dayNamesShort: [ "Dim", "Lun", "Mar", "Mer", "Jeu", "Ven", "Sam" ],
                firstDay : 1,
                monthNames: [ "Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre" ],
                monthNamesShort: [ "Jan", "Fev", "Mars", "Avr", "Mai", "Juin", "Jul", "Août", "Sep", "Oct", "Nov", "Dec" ],
                beforeShowDay: function(date){
                    show = true;
                    if(date.getDay() == 0)
                    {
                        show = false;
                    }
                    for (var i = 0; i < holidays.length; i++) {
                        if (new Date(holidays[i]).toString() == date.toString())
                        {
                            show = false;
                        }
                    }
                    var display = [show,'',(show)?'':'Hors dimanche et jours fériés'];
                    return display;
                },
                onSelect : function () {
                    var date = document.getElementById('booking_bookingday').value;
                    choiceTypeTicket(date);
                    var field = date;
                    var url = 'http://127.0.0.1:8000/ajax';
                    $(document).ready(function () {
                        $.ajax({
                            type: 'POST',
                            url: url,
                            data: 'field='+field,
                            success: function () {
                                document.getElementById('submitBooking').style.display ="block";
                                document.getElementById('messageSold').style.display="none";

                            },
                            error: function () {
                                document.getElementById('submitBooking').style.display ="none";
                                document.getElementById('messageSold').style.display="block";
                            }
                        })});


                }

            });
        } );

        function choiceTypeTicket(date)
        {

            var today = new Date();

            var dd = today.getDate();
            var mm = today.getMonth() + 1;
            var yyyy = today.getFullYear();
            if (dd < 10) {
                dd = '0' + dd;
            }
            if (mm < 10) {
                mm = '0' + mm;
            }
            var currentDate = dd + '/' + mm + '/' + yyyy;

            var UTChours = today.getUTCHours();
            var currentHour = UTChours + 1;

            if ((date === currentDate) && (currentHour >= 14))
            {
                document.getElementById('booking_type_1').checked = true;
                document.getElementById('booking_type').style.display = "none";
                document.getElementById('halfDay').style.display = 'block';
            }
            else
            {
                document.getElementById('booking_type').style.display = 'block';
                document.getElementById('halfDay').style.display = 'none';
            }

        }

        $(document).ready(function() {
            $('a[href^="#"]').click(function (evt) {
                evt.preventDefault();
                var target = $(this).attr('href');
                $('html, body')
                    .stop()
                    .animate({scrollTop: $(target).offset().top}, 1000);
            });
        });

    </script>


{% endblock %}